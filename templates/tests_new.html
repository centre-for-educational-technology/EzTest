{% include "header.html" %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-tagsinput/1.3.6/jquery.tagsinput.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dragula/3.6.8/dragula.css">

<form action="/tests/{% if test.TestID %}edit/{{test.TestID}}{% else %}new{% endif %}" enctype="multipart/form-data" method="POST" id="js-test-form">

<div id="js-affix">
	<div class="top-buttons">
		<div class="container">
			<div class="pull-right">
				{% if test.TestID %}
					<a href="/assignments/new?id={{test.TestID}}" class="btn"><i class="fa fa-plus-circle"></i> Assign Test</a>
				{% endif %}
				<button type="submit" name="save" value="yes" class="btn createnew"><i class="fa fa-plus-circle"></i> Save Test</button>
			</div>
			
			<button type="submit" name="save" value="add_questions" class="createnew" id="js-add-questions"><i class="fa fa-plus-circle"></i>Add Questions</button>
		</div>
	</div>
</div>

<div class='container' style='padding-top:20px;'>
	<div class='row'>
		<div class='col-xs-12'>
			<h2>{{title}}</h2>
			
			<div class="form-group">
				<label for="js-input-name">Name</label>
				<p class="help-block">Enter your test name</p>
				<input autofocus required type="text" class="form-control" id="js-input-name" placeholder="History 10a" name="name" value="{{test.Name}}">
			</div>
			<div class="form-group">
				<label for="js-upload-tags">Tags</label>
				<p class="help-block">Please enter your test tags using commas for separation</p>
				<input type="text" placeholder="History, WWII, Tanks" class="input" name="tags" id="js-upload-tags" value="{{test.Tags}}">
				
				<div class="form-tags">
				{% for tag, count in tags %}
					<span class="label label-default js-upload-tag" data-tag="{{tag}}">{{tag}}</span>
				{% endfor %}
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container">
	<label for="js-questions-table">Test Questions</label>
	<p class="help-block">You can move and order your questions using <i class="fa fa-arrows-v"></i> drag and drop</p>
	
	<div id="js-questions-table" class='dragon'>
	{% for question in questions %}
		<div class="row js-question" data-id="">
			<input type="hidden" name="questions[]" value="{{question.QuestionID}}">
			<div class='col-xs-1'>
				<i class="fa fa-arrows-v"></i>
				<span class="js-question-number">{{ loop.index }}</span>
			</div>
			<div class='col-xs-10'>
				{{question.Stimulus | raw}}
			</div>
			<div class='col-xs-1 text-right'>
				<i class="fa fa-times js-delete-question"></i>
			</div>
		</div>
	{% endfor %}
	</div>
</div>

</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/dragula/3.6.8/dragula.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-tagsinput/1.3.6/jquery.tagsinput.min.js"></script>
<script>
(function()
{
	$('#js-affix').affix({
		offset:
		{
			top: $('#js-affix').offset().top
		}
	});
	
	dragula([document.getElementById('js-questions-table')],
	{
		direction: 'horizontal',
	}).on('drop', function()
	{
		var i = 1;
		
		$('.js-question-number').each(function()
		{
			$(this).text(i++);	
		});
	});
	
	$('#js-questions-table').on('click', '.js-delete-question', function()
	{
		$(this).closest('.js-question').remove();
		
		return false;
	});
	
	var uploadTagsInput = $('#js-upload-tags').tagsInput({
		width: 'auto'
	});
	
	$('.js-upload-tag').on('click', function()
	{
		var tag = $(this).data('tag');
		
		if(!uploadTagsInput.tagExist(tag))
		{
			uploadTagsInput.addTag(tag);
		}
		
		$(this).remove();
		
		return false;
	});
	
	$('#js-add-questions').on('click', function()
	{
		$('#js-input-name').removeAttr('required');
		$('#js-test-form').attr('action', '/questions{% if test.TestID %}/add/{{test.TestID}}{% endif %}');
	});
}());
</script>
{% include "footer.html" %}
